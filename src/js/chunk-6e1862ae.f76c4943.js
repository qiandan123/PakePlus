(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e1862ae"],{"3af4":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"picture-wrap"},[i("div",{staticClass:"picture-content"},[i("PictureDrawing",{attrs:{height:t.pictureHeight,width:t.pictureWidth,points:t.tableData,defaultSelectedShape:t.selectedShape},on:{shapeClick:t.onShapeClick}})],1),i("div",{staticClass:"table-info"},[i("el-table",{attrs:{border:"",data:t.selectedShape?[t.selectedShape]:[]}},[i("el-table-column",{attrs:{prop:"id",label:"货物"}}),i("el-table-column",{attrs:{prop:"location",label:"描述"}}),i("el-table-column",{attrs:{prop:"tTray.gridQuantity",label:"货物注意事项",width:"180"}}),i("el-table-column",{attrs:{prop:"storageUnitIdentifier",label:"库存"}}),i("el-table-column",{attrs:{prop:"xLocation",label:"分格"}}),i("el-table-column",{attrs:{prop:"fff",label:"字马"}}),i("el-table-column",{attrs:{prop:"ddd",label:"物料状态"}}),i("el-table-column",{attrs:{prop:"eee",label:"包装类别"}}),i("el-table-column",{attrs:{prop:"ggg",label:"完成日期"}})],1)],1)])},a=[],h=(i("e9f5"),i("ab43"),i("9f49")),c={name:"picture",data(){return{tableData:this.$store.state.operate.operateList.map(t=>({...t.tGrid,background:t.background})),pictureWidth:this.$store.state.operate.picture.width,pictureHeight:this.$store.state.operate.picture.height}},computed:{selectedShape(){return this.$store.state.operate.selectedOperate}},components:{PictureDrawing:h["a"]},methods:{onShapeClick(t){this.$store.commit("operate/changeSelectedOperate",t)}}},l=c,n=(i("c14c"),i("2877")),o=Object(n["a"])(l,s,a,!1,null,"bbf6ee44",null);e["default"]=o.exports},"9f49":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"canvasContainer",staticClass:"canvas-container"},[i("canvas",{ref:"canvas",attrs:{width:t.canvasWidth,height:t.canvasHeight},on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove,mouseup:t.handleMouseUp,mouseleave:t.handleMouseLeave}})])},a=[];i("14d9"),i("e9f5"),i("7d54"),i("ab43");const h={"黄色":"#ffb700","红色":"#ff0000","蓝色":"#0022ff","绿色":"#2ed701","紫色":"#7001d7"},c=80;var l={name:"CanvasDrawing",props:{clickable:{type:Boolean,default:!0},moveable:{type:Boolean,default:!1},resizable:{type:Boolean,default:!1},width:{type:Number,default:1900,required:!0},height:{type:Number,default:654,required:!0},points:{type:Array,default:()=>[]},defaultSelectedShape:{type:Object,default:null}},watch:{width:{handler(t){this.originalWidth=t+2*c},immediate:!0},height:{handler(t){this.originalHeight=t+2*c},immediate:!0},defaultSelectedShape:{handler(t){t&&this.handleDefaultSelectedShape()},immediate:!0},points:{handler(){this.loadShapes()},immediate:!0}},data(){return{canvasWidth:0,canvasHeight:0,ctx:null,shapes:[],isDragging:!1,selectedShape:null,startX:0,startY:0,scale:1,originalWidth:1900,originalHeight:654,resizeHandleSize:10,snapThreshold:10,isResizing:!1}},mounted(){this.initCanvas(),window.addEventListener("resize",this.handleResize),this.$nextTick(()=>this.handleResize())},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{getAllShapes(){return JSON.parse(JSON.stringify(this.shapes))},initCanvas(){const t=this.$refs.canvas;this.ctx=t.getContext("2d")},handleDefaultSelectedShape(){if(!this.defaultSelectedShape||!this.shapes.length)return;const t=this.shapes.findIndex(t=>t.xLocation===this.defaultSelectedShape.xLocation&&t.yLocation===this.defaultSelectedShape.yLocation&&t.xSize===this.defaultSelectedShape.xSize&&t.ySize===this.defaultSelectedShape.ySize);t>-1&&(this.selectedShape=this.shapes[t],this.shapes.splice(t,1),this.shapes.push(this.selectedShape),this.$nextTick(()=>{this.drawShapes()}))},async loadShapes(){try{this.shapes=this.points.map(t=>({...t,background:h[t.background]||"#fff"})),this.drawShapes(),this.$nextTick(()=>{this.handleDefaultSelectedShape()})}catch(t){console.error("加载图形数据失败:",t)}},handleResize(){const t=this.$refs.canvasContainer;if(!t||!this.ctx)return;const e=t.clientWidth,i=t.clientHeight,s=e/this.originalWidth,a=i/this.originalHeight,h=Math.min(a,s);Math.abs(h-this.scale)>.001&&(this.scale=h,this.canvasWidth=this.originalWidth*this.scale,this.canvasHeight=this.originalHeight*this.scale,this.$nextTick(()=>{this.drawShapes()}))},isOverlapping(t,e){return!(c+t.xLocation+t.xSize<=c+e.xLocation||c+t.xLocation>=c+e.xLocation+e.xSize||c+t.yLocation+t.ySize<=c+e.yLocation||c+t.yLocation>=c+e.yLocation+e.ySize)},getOverlapRect(t,e){const i=Math.max(c+t.xLocation,c+e.xLocation),s=Math.max(c+t.yLocation,c+e.yLocation),a=Math.min(c+t.xLocation+t.xSize,c+e.xLocation+e.xSize),h=Math.min(c+t.yLocation+t.ySize,c+e.yLocation+e.ySize);return{xLocation:i,yLocation:s,xSize:a-i,ySize:h-s}},drawPattern(t){const{xLocation:e,yLocation:i,xSize:s,ySize:a}=t,h=10/this.scale/2;this.ctx.save(),this.ctx.strokeStyle="rgba(0,0,0,0.5)",this.ctx.lineWidth=1/this.scale,this.ctx.beginPath(),this.ctx.rect(e,i,s,a),this.ctx.clip();for(let c=-a;c<s+a;c+=h)this.ctx.beginPath(),this.ctx.moveTo(e+c,i),this.ctx.lineTo(e+c+a,i+a),this.ctx.stroke();this.ctx.restore()},isInResizeHandle(t,e,i){const s=t.xLocation+t.xSize,a=t.yLocation+t.ySize;return e>=s-this.resizeHandleSize/this.scale&&e<=s+this.resizeHandleSize/this.scale&&i>=a-this.resizeHandleSize/this.scale&&i<=a+this.resizeHandleSize/this.scale},drawShapes(){if(!this.ctx)return;this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.save(),this.ctx.scale(this.scale,this.scale),this.drawCoordinateSystem(),this.shapes.forEach(t=>{this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.fillStyle=t.background||"#cccccc",this.ctx.fillRect(c+t.xLocation,c+t.yLocation,t.xSize,t.ySize),this.clickable&&t===this.selectedShape?(this.ctx.strokeStyle="#3498db",this.ctx.lineWidth=4/this.scale):(this.ctx.strokeStyle="#000000",this.ctx.lineWidth=1/this.scale),this.ctx.strokeRect(c+t.xLocation,c+t.yLocation,t.xSize,t.ySize)});const t=[];for(let e=0;e<this.shapes.length;e++)for(let i=e+1;i<this.shapes.length;i++)if(this.isOverlapping(this.shapes[e],this.shapes[i])){const s=this.getOverlapRect(this.shapes[e],this.shapes[i]);t.push(s)}t.forEach(t=>{this.drawPattern(t)}),this.ctx.restore()},drawCoordinateSystem(){if(!this.ctx)return;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),e="0123456789".split(""),i=this.originalWidth-2*c,s=this.originalHeight-2*c,a=i/25,h=s/9;this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="transparent",this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.strokeRect(c,c,i,s);let l=-1,n=-1;if(this.selectedShape){const i=c+this.selectedShape.xLocation+this.selectedShape.xSize/2,s=c+this.selectedShape.yLocation+this.selectedShape.ySize/2;l=Math.round((i-c)/a),n=Math.round((s-c)/h),l=Math.min(Math.max(0,l),t.length-1),n=Math.min(Math.max(0,n),e.length-1)}for(let o=0;o<t.length;o++){0===o||o===t.length-1||o===l?(this.ctx.fillStyle=o===l?"#3498db":"#fff",this.ctx.font=o===l?14/this.scale+"px Arial":12/this.scale+"px Arial"):this.ctx.fillStyle="#fff";const e=c+o*a,i=this.originalHeight-c/2;this.ctx.fillText(t[o],e,i)}for(let o=0;o<e.length;o++){0===o||o===e.length-1||o===n?(this.ctx.fillStyle=o===n?"#3498db":"#fff",this.ctx.font=o===n?14/this.scale+"px Arial":12/this.scale+"px Arial"):this.ctx.fillStyle="#fff";const t=c/2,i=c+o*h;this.ctx.fillText(e[o],t,i)}if(this.selectedShape&&l>=0&&n>=0){const t=c+this.selectedShape.xLocation+this.selectedShape.xSize/2,e=c+this.selectedShape.yLocation+this.selectedShape.ySize/2;this.ctx.strokeStyle="rgb(52, 152, 219)",this.ctx.lineWidth=2/this.scale;const i=5/this.scale;this.ctx.setLineDash([i,i]),this.ctx.beginPath(),this.ctx.moveTo(t,c),this.ctx.lineTo(t,this.originalHeight-c),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(c,e),this.ctx.lineTo(this.originalWidth-c,e),this.ctx.stroke(),this.ctx.setLineDash([])}},updateCursor(t){if(!this.resizable&&!this.moveable&&!this.clickable)return void(this.$refs.canvas.style.cursor="default");const e=this.$refs.canvas.getBoundingClientRect(),i=(t.clientX-e.left)/this.scale-c,s=(t.clientY-e.top)/this.scale-c;let a=!1;if(this.resizable)for(let h=this.shapes.length-1;h>=0;h--)if(this.isInResizeHandle(this.shapes[h],i,s)){this.$refs.canvas.style.cursor="nwse-resize",a=!0;break}if(!a){if(this.clickable)for(let t=this.shapes.length-1;t>=0;t--){const e=this.shapes[t];if(i>=e.xLocation&&i<=e.xLocation+e.xSize&&s>=e.yLocation&&s<=e.yLocation+e.ySize)return void(this.$refs.canvas.style.cursor=this.moveable?"move":"pointer")}if(this.clickable)for(let t=this.shapes.length-1;t>=0;t--){const e=this.shapes[t];if(i>=e.xLocation&&i<=e.xLocation+e.xSize&&s>=e.yLocation&&s<=e.yLocation+e.ySize)return void(this.$refs.canvas.style.cursor="pointer")}this.$refs.canvas.style.cursor="default"}},handleMouseDown(t){t.preventDefault();const e=this.$refs.canvas.getBoundingClientRect(),i=(t.clientX-e.left)/this.scale-c,s=(t.clientY-e.top)/this.scale-c;if(this.resizable)for(let h=this.shapes.length-1;h>=0;h--){const t=this.shapes[h];if(this.isInResizeHandle(t,i,s))return this.isResizing=!0,this.selectedShape=t,this.startX=i,void(this.startY=s)}let a=!1;for(let h=this.shapes.length-1;h>=0;h--){const t=this.shapes[h];if(i>=t.xLocation&&i<=t.xLocation+t.xSize&&s>=t.yLocation&&s<=t.yLocation+t.ySize){a=!0,this.clickable&&(this.selectedShape=t,h<this.shapes.length-1&&(this.shapes.splice(h,1),this.shapes.push(this.selectedShape)),this.$emit("shapeClick",JSON.parse(JSON.stringify(t)))),this.moveable&&(this.isDragging=!0,this.selectedShape=t,this.startX=i-t.xLocation,this.startY=s-t.yLocation),this.drawShapes();break}}a||(this.selectedShape=null,this.$emit("shapeClick",void 0),this.drawShapes())},handleMouseMove(t){if(this.updateCursor(t),!this.moveable&&!this.resizable)return;const e=this.$refs.canvas.getBoundingClientRect(),i=(t.clientX-e.left)/this.scale-c,s=(t.clientY-e.top)/this.scale-c;if(this.resizable&&this.isResizing&&this.selectedShape){const t=Math.max(10,i-this.selectedShape.xLocation),e=Math.max(10,s-this.selectedShape.yLocation);return this.selectedShape.xSize=t,this.selectedShape.ySize=e,void this.drawShapes()}if(this.moveable&&this.isDragging&&this.selectedShape){let t=i-this.startX,e=s-this.startY;const a=this.applySnapping(t,e);t=a.x,e=a.y,t=Math.max(0,t),e=Math.max(0,e),t=Math.min(t,this.originalWidth-2*c-this.selectedShape.xSize),e=Math.min(e,this.originalHeight-2*c-this.selectedShape.ySize),this.selectedShape.xLocation=t,this.selectedShape.yLocation=e,this.drawShapes()}},applySnapping(t,e){if(!this.selectedShape)return{x:t,y:e};const i=t,s=t+this.selectedShape.xSize,a=e,h=e+this.selectedShape.ySize,c=t+this.selectedShape.xSize/2,l=e+this.selectedShape.ySize/2;let n=t,o=e;for(const r of this.shapes){if(r===this.selectedShape)continue;const t=r.xLocation,e=r.xLocation+r.xSize,d=r.yLocation,p=r.yLocation+r.ySize,S=r.xLocation+r.xSize/2,f=r.yLocation+r.ySize/2;Math.abs(i-t)<this.snapThreshold?n=t:Math.abs(s-e)<this.snapThreshold?n=e-this.selectedShape.xSize:Math.abs(i-e)<this.snapThreshold?n=e:Math.abs(s-t)<this.snapThreshold?n=t-this.selectedShape.xSize:Math.abs(c-S)<this.snapThreshold&&(n=S-this.selectedShape.xSize/2),Math.abs(a-d)<this.snapThreshold?o=d:Math.abs(h-p)<this.snapThreshold?o=p-this.selectedShape.ySize:Math.abs(a-p)<this.snapThreshold?o=p:Math.abs(h-d)<this.snapThreshold?o=d-this.selectedShape.ySize:Math.abs(l-f)<this.snapThreshold&&(o=f-this.selectedShape.ySize/2)}return{x:n,y:o}},handleMouseUp(){this.isDragging=!1,this.isResizing=!1},handleMouseLeave(){this.isDragging=!1,this.isResizing=!1,this.drawShapes()}}},n=l,o=(i("fb9e"),i("2877")),r=Object(o["a"])(n,s,a,!1,null,"7cebed9c",null);e["a"]=r.exports},"9f5d":function(t,e,i){},c14c:function(t,e,i){"use strict";i("9f5d")},fb9e:function(t,e,i){"use strict";i("fdfc")},fdfc:function(t,e,i){}}]);