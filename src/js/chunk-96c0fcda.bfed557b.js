(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-96c0fcda"],{1654:function(t,e,s){},"7f68":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"operate-wrap"},[s("div",{staticClass:"operate-content"},[s("div",{staticClass:"operate-left"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"160px"}},[s("el-form-item",{attrs:{label:"库存",prop:"goodsCode"}},[s("el-input",{attrs:{placeholder:"输入货物编码"},model:{value:t.form.goodsCode,callback:function(e){t.$set(t.form,"goodsCode",e)},expression:"form.goodsCode"}})],1),s("div",{staticClass:"form-row"},[s("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"要求数量",prop:"requiredAmount"}},[s("el-input",{attrs:{placeholder:"请输入要求数量"},model:{value:t.form.requiredAmount,callback:function(e){t.$set(t.form,"requiredAmount",e)},expression:"form.requiredAmount"}})],1),s("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"位置",prop:"location"}},[s("el-input",{attrs:{placeholder:"请输入位置"},model:{value:t.form.location,callback:function(e){t.$set(t.form,"location",e)},expression:"form.location"}})],1)],1),s("div",{staticClass:"form-row"},[s("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"指令",prop:"instructionType"}},[s("el-input",{attrs:{placeholder:"请输入指令"},model:{value:t.form.instructionType,callback:function(e){t.$set(t.form,"instructionType",e)},expression:"form.instructionType"}})],1),s("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"已执行数量",prop:"executeAmount"}},[s("el-input",{attrs:{placeholder:"请输入已执行数量"},model:{value:t.form.executeAmount,callback:function(e){t.$set(t.form,"executeAmount",e)},expression:"form.executeAmount"}})],1)],1)],1),s("div",{staticClass:"table-wrap"},[s("el-table",{attrs:{height:"200",border:"",data:t.tableData}},[s("el-table-column",{attrs:{prop:"id",label:"生成数量",width:"180"}}),s("el-table-column",{attrs:{prop:"precautions",label:"请求计划事项",width:"180"}}),s("el-table-column",{attrs:{prop:"description",label:"描述"}}),s("el-table-column",{attrs:{prop:"tTray.trayDefaultCode",label:"货物计划事项",width:"180"}}),s("el-table-column",{attrs:{prop:"inventoryType",label:"余下操作"}})],1)],1)],1),s("div",{staticClass:"operate-buttons"},[s("div",{staticClass:"btn-item"},[s("el-button",{directives:[{name:"longpress",rawName:"v-longpress"}],staticStyle:{width:"100%"},attrs:{type:"success"}},[t._v(" 保存 ")])],1),s("div",{staticClass:"btn-item"},[s("el-button",{directives:[{name:"longpress",rawName:"v-longpress"}],staticStyle:{width:"100%"},attrs:{type:"warning"},on:{click:t.onUpdate}},[t._v(" 修改 ")])],1),s("div",{staticClass:"btn-item"},[s("el-button",{directives:[{name:"longpress",rawName:"v-longpress"}],staticStyle:{width:"100%"},attrs:{type:"warning"},on:{click:t.onPalletInventory}},[t._v(" 托盘盘点 ")])],1),s("div",{staticClass:"btn-item"},[s("el-button",{directives:[{name:"longpress",rawName:"v-longpress"}],staticStyle:{width:"100%"},attrs:{type:"warning"}},[t._v(" 标签 ")])],1),s("div",{staticClass:"btn-item"},[s("el-button",{directives:[{name:"longpress",rawName:"v-longpress"}],staticStyle:{width:"100%"},attrs:{type:"primary"}},[t._v(" 库位为空 ")])],1)])]),s("div",{staticClass:"picture-wrap"},[s("PictureDrawing",{attrs:{height:t.pictureHeight,width:t.pictureWidth,points:t.tableData,clickable:!1}})],1)])},a=[],h=(s("14d9"),s("e9f5"),s("f665"),s("ab43"),s("9f49")),o=s("2f62"),n={data(){return{form:{},tableData:this.$store.state.operate.operateList.map(t=>({...t.tGrid,background:t.background})),pictureWidth:this.$store.state.operate.picture.width,pictureHeight:this.$store.state.operate.picture.height}},mounted(){},computed:{...Object(o["b"])(["getUserResource","getRouteData"]),userResource(){return this.getUserResource},routeData(){return this.getRouteData}},components:{PictureDrawing:h["a"]},meta:{title:"拣取界面"},methods:{hasPermission(t){const e=this.routeData,s=e=>{const s=e.find(e=>e.name===t);return s?s.path:null},i=s(e);return console.log(i),console.log(i),this.userResource.includes(i)},onUpdate(){this.$router.push({path:"/dashboard/operateData/operateByGoods/update"})},onPalletInventory(){this.$router.push({path:"/dashboard/operateData/operateByGoods/palletInventory/table"})}}},l=n,c=(s("f132"),s("2877")),r=Object(c["a"])(l,i,a,!1,null,"2614d499",null);e["default"]=r.exports},"9f49":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"canvasContainer",staticClass:"canvas-container"},[s("canvas",{ref:"canvas",attrs:{width:t.canvasWidth,height:t.canvasHeight},on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove,mouseup:t.handleMouseUp,mouseleave:t.handleMouseLeave}})])},a=[];s("14d9"),s("e9f5"),s("7d54"),s("ab43");const h={"黄色":"#ffb700","红色":"#ff0000","蓝色":"#0022ff","绿色":"#2ed701","紫色":"#7001d7"},o=80;var n={name:"CanvasDrawing",props:{clickable:{type:Boolean,default:!0},moveable:{type:Boolean,default:!1},resizable:{type:Boolean,default:!1},width:{type:Number,default:1900,required:!0},height:{type:Number,default:654,required:!0},points:{type:Array,default:()=>[]},defaultSelectedShape:{type:Object,default:null}},watch:{width:{handler(t){this.originalWidth=t+2*o},immediate:!0},height:{handler(t){this.originalHeight=t+2*o},immediate:!0},defaultSelectedShape:{handler(t){t&&this.handleDefaultSelectedShape()},immediate:!0},points:{handler(){this.loadShapes()},immediate:!0}},data(){return{canvasWidth:0,canvasHeight:0,ctx:null,shapes:[],isDragging:!1,selectedShape:null,startX:0,startY:0,scale:1,originalWidth:1900,originalHeight:654,resizeHandleSize:10,snapThreshold:10,isResizing:!1}},mounted(){this.initCanvas(),window.addEventListener("resize",this.handleResize),this.$nextTick(()=>this.handleResize())},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{getAllShapes(){return JSON.parse(JSON.stringify(this.shapes))},initCanvas(){const t=this.$refs.canvas;this.ctx=t.getContext("2d")},handleDefaultSelectedShape(){if(!this.defaultSelectedShape||!this.shapes.length)return;const t=this.shapes.findIndex(t=>t.xLocation===this.defaultSelectedShape.xLocation&&t.yLocation===this.defaultSelectedShape.yLocation&&t.xSize===this.defaultSelectedShape.xSize&&t.ySize===this.defaultSelectedShape.ySize);t>-1&&(this.selectedShape=this.shapes[t],this.shapes.splice(t,1),this.shapes.push(this.selectedShape),this.$nextTick(()=>{this.drawShapes()}))},async loadShapes(){try{this.shapes=this.points.map(t=>({...t,background:h[t.background]||"#fff"})),this.drawShapes(),this.$nextTick(()=>{this.handleDefaultSelectedShape()})}catch(t){console.error("加载图形数据失败:",t)}},handleResize(){const t=this.$refs.canvasContainer;if(!t||!this.ctx)return;const e=t.clientWidth,s=t.clientHeight,i=e/this.originalWidth,a=s/this.originalHeight,h=Math.min(a,i);Math.abs(h-this.scale)>.001&&(this.scale=h,this.canvasWidth=this.originalWidth*this.scale,this.canvasHeight=this.originalHeight*this.scale,this.$nextTick(()=>{this.drawShapes()}))},isOverlapping(t,e){return!(o+t.xLocation+t.xSize<=o+e.xLocation||o+t.xLocation>=o+e.xLocation+e.xSize||o+t.yLocation+t.ySize<=o+e.yLocation||o+t.yLocation>=o+e.yLocation+e.ySize)},getOverlapRect(t,e){const s=Math.max(o+t.xLocation,o+e.xLocation),i=Math.max(o+t.yLocation,o+e.yLocation),a=Math.min(o+t.xLocation+t.xSize,o+e.xLocation+e.xSize),h=Math.min(o+t.yLocation+t.ySize,o+e.yLocation+e.ySize);return{xLocation:s,yLocation:i,xSize:a-s,ySize:h-i}},drawPattern(t){const{xLocation:e,yLocation:s,xSize:i,ySize:a}=t,h=10/this.scale/2;this.ctx.save(),this.ctx.strokeStyle="rgba(0,0,0,0.5)",this.ctx.lineWidth=1/this.scale,this.ctx.beginPath(),this.ctx.rect(e,s,i,a),this.ctx.clip();for(let o=-a;o<i+a;o+=h)this.ctx.beginPath(),this.ctx.moveTo(e+o,s),this.ctx.lineTo(e+o+a,s+a),this.ctx.stroke();this.ctx.restore()},isInResizeHandle(t,e,s){const i=t.xLocation+t.xSize,a=t.yLocation+t.ySize;return e>=i-this.resizeHandleSize/this.scale&&e<=i+this.resizeHandleSize/this.scale&&s>=a-this.resizeHandleSize/this.scale&&s<=a+this.resizeHandleSize/this.scale},drawShapes(){if(!this.ctx)return;this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.save(),this.ctx.scale(this.scale,this.scale),this.drawCoordinateSystem(),this.shapes.forEach(t=>{this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.fillStyle=t.background||"#cccccc",this.ctx.fillRect(o+t.xLocation,o+t.yLocation,t.xSize,t.ySize),this.clickable&&t===this.selectedShape?(this.ctx.strokeStyle="#3498db",this.ctx.lineWidth=4/this.scale):(this.ctx.strokeStyle="#000000",this.ctx.lineWidth=1/this.scale),this.ctx.strokeRect(o+t.xLocation,o+t.yLocation,t.xSize,t.ySize)});const t=[];for(let e=0;e<this.shapes.length;e++)for(let s=e+1;s<this.shapes.length;s++)if(this.isOverlapping(this.shapes[e],this.shapes[s])){const i=this.getOverlapRect(this.shapes[e],this.shapes[s]);t.push(i)}t.forEach(t=>{this.drawPattern(t)}),this.ctx.restore()},drawCoordinateSystem(){if(!this.ctx)return;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),e="0123456789".split(""),s=this.originalWidth-2*o,i=this.originalHeight-2*o,a=s/25,h=i/9;this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="transparent",this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.strokeRect(o,o,s,i);let n=-1,l=-1;if(this.selectedShape){const s=o+this.selectedShape.xLocation+this.selectedShape.xSize/2,i=o+this.selectedShape.yLocation+this.selectedShape.ySize/2;n=Math.round((s-o)/a),l=Math.round((i-o)/h),n=Math.min(Math.max(0,n),t.length-1),l=Math.min(Math.max(0,l),e.length-1)}for(let c=0;c<t.length;c++){0===c||c===t.length-1||c===n?(this.ctx.fillStyle=c===n?"#3498db":"#fff",this.ctx.font=c===n?14/this.scale+"px Arial":12/this.scale+"px Arial"):this.ctx.fillStyle="#fff";const e=o+c*a,s=this.originalHeight-o/2;this.ctx.fillText(t[c],e,s)}for(let c=0;c<e.length;c++){0===c||c===e.length-1||c===l?(this.ctx.fillStyle=c===l?"#3498db":"#fff",this.ctx.font=c===l?14/this.scale+"px Arial":12/this.scale+"px Arial"):this.ctx.fillStyle="#fff";const t=o/2,s=o+c*h;this.ctx.fillText(e[c],t,s)}if(this.selectedShape&&n>=0&&l>=0){const t=o+this.selectedShape.xLocation+this.selectedShape.xSize/2,e=o+this.selectedShape.yLocation+this.selectedShape.ySize/2;this.ctx.strokeStyle="rgb(52, 152, 219)",this.ctx.lineWidth=2/this.scale;const s=5/this.scale;this.ctx.setLineDash([s,s]),this.ctx.beginPath(),this.ctx.moveTo(t,o),this.ctx.lineTo(t,this.originalHeight-o),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(o,e),this.ctx.lineTo(this.originalWidth-o,e),this.ctx.stroke(),this.ctx.setLineDash([])}},updateCursor(t){if(!this.resizable&&!this.moveable&&!this.clickable)return void(this.$refs.canvas.style.cursor="default");const e=this.$refs.canvas.getBoundingClientRect(),s=(t.clientX-e.left)/this.scale-o,i=(t.clientY-e.top)/this.scale-o;let a=!1;if(this.resizable)for(let h=this.shapes.length-1;h>=0;h--)if(this.isInResizeHandle(this.shapes[h],s,i)){this.$refs.canvas.style.cursor="nwse-resize",a=!0;break}if(!a){if(this.clickable)for(let t=this.shapes.length-1;t>=0;t--){const e=this.shapes[t];if(s>=e.xLocation&&s<=e.xLocation+e.xSize&&i>=e.yLocation&&i<=e.yLocation+e.ySize)return void(this.$refs.canvas.style.cursor=this.moveable?"move":"pointer")}if(this.clickable)for(let t=this.shapes.length-1;t>=0;t--){const e=this.shapes[t];if(s>=e.xLocation&&s<=e.xLocation+e.xSize&&i>=e.yLocation&&i<=e.yLocation+e.ySize)return void(this.$refs.canvas.style.cursor="pointer")}this.$refs.canvas.style.cursor="default"}},handleMouseDown(t){t.preventDefault();const e=this.$refs.canvas.getBoundingClientRect(),s=(t.clientX-e.left)/this.scale-o,i=(t.clientY-e.top)/this.scale-o;if(this.resizable)for(let h=this.shapes.length-1;h>=0;h--){const t=this.shapes[h];if(this.isInResizeHandle(t,s,i))return this.isResizing=!0,this.selectedShape=t,this.startX=s,void(this.startY=i)}let a=!1;for(let h=this.shapes.length-1;h>=0;h--){const t=this.shapes[h];if(s>=t.xLocation&&s<=t.xLocation+t.xSize&&i>=t.yLocation&&i<=t.yLocation+t.ySize){a=!0,this.clickable&&(this.selectedShape=t,h<this.shapes.length-1&&(this.shapes.splice(h,1),this.shapes.push(this.selectedShape)),this.$emit("shapeClick",JSON.parse(JSON.stringify(t)))),this.moveable&&(this.isDragging=!0,this.selectedShape=t,this.startX=s-t.xLocation,this.startY=i-t.yLocation),this.drawShapes();break}}a||(this.selectedShape=null,this.$emit("shapeClick",void 0),this.drawShapes())},handleMouseMove(t){if(this.updateCursor(t),!this.moveable&&!this.resizable)return;const e=this.$refs.canvas.getBoundingClientRect(),s=(t.clientX-e.left)/this.scale-o,i=(t.clientY-e.top)/this.scale-o;if(this.resizable&&this.isResizing&&this.selectedShape){const t=Math.max(10,s-this.selectedShape.xLocation),e=Math.max(10,i-this.selectedShape.yLocation);return this.selectedShape.xSize=t,this.selectedShape.ySize=e,void this.drawShapes()}if(this.moveable&&this.isDragging&&this.selectedShape){let t=s-this.startX,e=i-this.startY;const a=this.applySnapping(t,e);t=a.x,e=a.y,t=Math.max(0,t),e=Math.max(0,e),t=Math.min(t,this.originalWidth-2*o-this.selectedShape.xSize),e=Math.min(e,this.originalHeight-2*o-this.selectedShape.ySize),this.selectedShape.xLocation=t,this.selectedShape.yLocation=e,this.drawShapes()}},applySnapping(t,e){if(!this.selectedShape)return{x:t,y:e};const s=t,i=t+this.selectedShape.xSize,a=e,h=e+this.selectedShape.ySize,o=t+this.selectedShape.xSize/2,n=e+this.selectedShape.ySize/2;let l=t,c=e;for(const r of this.shapes){if(r===this.selectedShape)continue;const t=r.xLocation,e=r.xLocation+r.xSize,d=r.yLocation,p=r.yLocation+r.ySize,u=r.xLocation+r.xSize/2,f=r.yLocation+r.ySize/2;Math.abs(s-t)<this.snapThreshold?l=t:Math.abs(i-e)<this.snapThreshold?l=e-this.selectedShape.xSize:Math.abs(s-e)<this.snapThreshold?l=e:Math.abs(i-t)<this.snapThreshold?l=t-this.selectedShape.xSize:Math.abs(o-u)<this.snapThreshold&&(l=u-this.selectedShape.xSize/2),Math.abs(a-d)<this.snapThreshold?c=d:Math.abs(h-p)<this.snapThreshold?c=p-this.selectedShape.ySize:Math.abs(a-p)<this.snapThreshold?c=p:Math.abs(h-d)<this.snapThreshold?c=d-this.selectedShape.ySize:Math.abs(n-f)<this.snapThreshold&&(c=f-this.selectedShape.ySize/2)}return{x:l,y:c}},handleMouseUp(){this.isDragging=!1,this.isResizing=!1},handleMouseLeave(){this.isDragging=!1,this.isResizing=!1,this.drawShapes()}}},l=n,c=(s("fb9e"),s("2877")),r=Object(c["a"])(l,i,a,!1,null,"7cebed9c",null);e["a"]=r.exports},f132:function(t,e,s){"use strict";s("1654")},fb9e:function(t,e,s){"use strict";s("fdfc")},fdfc:function(t,e,s){}}]);